{{ signature }}
    for (size_t n = 0; n < {{ batch }}; ++n) {
        for (size_t c = 0; c < {{ channels }}; ++c) {
            for (size_t h = 0; h < {{ in_h }}; ++h) {
                for (size_t w = 0; w < {{ in_w }}; ++w) {
                    out[n][c][h][w] = 0;
                }
            }
        }
    }
    for (size_t n = 0; n < {{ batch }}; ++n) {
        for (size_t c = 0; c < {{ channels }}; ++c) {
            for (size_t oh = 0; oh < {{ out_h }}; ++oh) {
                for (size_t ow = 0; ow < {{ out_w }}; ++ow) {
                    int64_t index = indices[n][c][oh][ow];
                    int64_t in_h_idx = index / {{ in_w }};
                    int64_t in_w_idx = index % {{ in_w }};
                    if (in_h_idx >= 0 && in_h_idx < {{ in_h }} && in_w_idx >= 0 && in_w_idx < {{ in_w }}) {
                        out[n][c][in_h_idx][in_w_idx] += grad_output[n][c][oh][ow];
                    }
                }
            }
        }
    }
}
